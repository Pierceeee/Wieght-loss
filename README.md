# PCOS Plan - Personalized Weight Loss Web App

A modern web application for women with PCOS (Polycystic Ovary Syndrome) to get personalized diet and lifestyle plans. Built with Next.js 16, TypeScript, Tailwind CSS, and AI-powered analysis and meal plan generation.

## Features

- **20-Step Onboarding Quiz**: Comprehensive assessment of symptoms, lifestyle, and goals
- **AI-Powered Analysis**: Personalized insights generated by GPT-4 or Gemini based on quiz responses
- **Personalized Summary**: BMI calculation, health risks, and projected timeline
- **AI-Powered Meal Plans**: Supports both OpenAI and Google Gemini for meal plan generation
- **Funnel Tracking**: Complete submission tracking from start to purchase
- **Subscription Management**: Stripe integration for recurring payments
- **User Dashboard**: View and regenerate meal plans, track progress

## Tech Stack

- **Framework**: Next.js 16 (App Router)
- **Language**: TypeScript
- **Styling**: Tailwind CSS + shadcn/ui
- **Database**: Supabase (PostgreSQL)
- **Authentication**: Supabase Auth
- **Payments**: Stripe
- **AI Providers**: OpenAI GPT-4o / Google Gemini 1.5 Pro

## Getting Started

### Prerequisites

- Node.js 18+ 
- npm or yarn
- Supabase account
- Stripe account
- OpenAI or Google AI API key

### Installation

1. Clone the repository:
   ```bash
   git clone <repository-url>
   ```

2. Install dependencies:
   ```bash
   npm install
   ```

3. Set up environment variables:
   ```bash
   cp .env.example .env.local
   ```

4. Configure your `.env.local` file with your API keys.

5. Set up the Supabase database (see Database Setup below)

6. Run the development server:
   ```bash
   npm run dev
   ```

7. Open [http://localhost:3000](http://localhost:3000)

## Environment Variables

```env
# Supabase
NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-supabase-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# Stripe
STRIPE_SECRET_KEY=sk_test_...
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_...
STRIPE_WEBHOOK_SECRET=whsec_...
STRIPE_MONTHLY_PRICE_ID=price_...
STRIPE_YEARLY_PRICE_ID=price_...
STRIPE_LIFETIME_PRICE_ID=price_...

# AI Provider: "openai" or "gemini"
AI_PROVIDER=openai

# OpenAI (required if AI_PROVIDER=openai)
OPENAI_API_KEY=sk-...
OPENAI_MODEL=gpt-4o  # optional, defaults to gpt-4o

# Google Gemini (required if AI_PROVIDER=gemini)
GOOGLE_AI_API_KEY=AIza...
GEMINI_MODEL=gemini-1.5-pro  # optional, defaults to gemini-1.5-pro

# App URL
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

## Database Setup

**Important**: Run the complete migration file provided in the repository:

```bash
# In your Supabase SQL Editor, run:
supabase-migration.sql
```

This creates the following tables:

### Main Tables

1. **funnel_submissions** - Tracks user progress through the funnel
   - `id` - UUID primary key
   - `created_at` - Timestamp
   - `answers` - JSONB with all quiz responses
   - `ai_analysis` - Generated personalized analysis text
   - `status` - Enum: 'started', 'completed', 'purchased'
   - `email` - User's email (captured at email step)

2. **profiles** - User profiles (extends auth.users)
3. **subscriptions** - Stripe subscription tracking
4. **meal_plans** - AI-generated meal plans

The migration file includes:
- Table creation with proper types
- Indexes for performance
- Row Level Security (RLS) policies
- Necessary permissions

### Manual Setup Alternative

If you prefer manual setup, copy and paste the contents of `supabase-migration.sql` into your Supabase SQL Editor and execute it.

## Stripe Setup

1. Create products and prices in Stripe Dashboard:
   - Monthly subscription ($19.99/month)
   - Yearly subscription ($119.88/year)
   - Lifetime access ($199 one-time)

2. Set up a webhook endpoint pointing to `/api/webhooks/stripe`

3. Enable the following webhook events:
   - `checkout.session.completed`
   - `customer.subscription.created`
   - `customer.subscription.updated`
   - `customer.subscription.deleted`
   - `invoice.payment_succeeded`
   - `invoice.payment_failed`

## Project Structure

```
pcos-plan/
├── src/
│   ├── app/
│   │   ├── api/
│   │   │   ├── checkout/           # NEW: Stripe checkout session creation
│   │   │   ├── generate-plan/      # AI meal plan generation
│   │   │   └── webhooks/stripe/    # Stripe webhook handler
│   │   ├── dashboard/              # User dashboard
│   │   ├── email/                  # Email capture (updates funnel status)
│   │   ├── offer/                  # Subscription plans (displays AI analysis)
│   │   ├── quiz/[step]/            # Dynamic quiz steps
│   │   ├── summary/                # Personal summary
│   │   ├── timeline/               # Weight loss projection
│   │   └── page.tsx                # Landing page
│   ├── components/
│   │   ├── quiz/                   # Quiz components
│   │   │   └── AnalyzingAnimation.tsx  # Triggers AI analysis generation
│   │   └── ui/                     # shadcn/ui components
│   ├── hooks/
│   │   └── useQuizState.ts         # Zustand quiz state
│   ├── lib/
│   │   ├── actions/                # NEW: Server Actions
│   │   │   ├── generate-analysis.ts    # AI analysis generation
│   │   │   └── submit-quiz.ts          # Funnel submission tracking
│   │   ├── ai/                     # AI provider abstraction
│   │   │   ├── provider.ts         # Interface + generateAnalysis method
│   │   │   ├── openai.ts           # OpenAI implementation
│   │   │   ├── gemini.ts           # Gemini implementation
│   │   │   └── index.ts            # Provider factory
│   │   ├── bmi.ts                  # BMI calculations
│   │   ├── quiz-data.ts            # Quiz questions
│   │   ├── stripe.ts               # Stripe utilities
│   │   ├── supabase.ts             # Supabase client + helper functions
│   │   └── utils.ts                # Utility functions
│   └── types/
│       ├── quiz.ts                 # Quiz types
│       └── user.ts                 # User types
├── docs/                           # Project documentation
├── supabase-migration.sql          # NEW: Database migration file
├── .env.example                    # Environment variables template
├── package.json
└── README.md
```

## Deployment

### Vercel (Recommended)

1. Push your code to GitHub
2. Import the repository in Vercel
3. Add all environment variables
4. Deploy

### Environment Variables in Vercel

Make sure to add all environment variables from `.env.example` to your Vercel project settings.

## Development Commands

```bash
# Development server
npm run dev

# Build for production
npm run build

# Start production server
npm start

# Lint code
npm run lint
```

## License

MIT

## Support

For support, email support@pcosplan.com or open an issue on GitHub.
